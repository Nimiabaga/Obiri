<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin — Price Editor</title>
  <meta name="robots" content="noindex,nofollow">
  <style>html.locked body{visibility:hidden}</style>
  <script>document.documentElement.classList.add('locked');</script>
  <style>
    :root{
      --bg:#0b0b0b; --panel:#141414; --ink:#f5f5f5; --muted:#a9a9a9; --line:#222;
      --accent:#ffffff; --danger:#ff4949;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    a{color:var(--ink);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 80px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    header img{height:38px;filter:grayscale(1) contrast(1.05) brightness(1.05)}
    .back{color:#fff;font-weight:800}
    h1{margin:6px 0 2px;font-size:26px;letter-spacing:.08em}
    .sub{color:var(--muted);margin:0 0 18px}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px}
    .btn{background:#fff;color:#000;font-weight:900;border:0;border-radius:999px;padding:.6rem 1rem;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-ghost{background:transparent;color:#fff;border:1px solid var(--line)}
    .btn-danger{background:var(--danger);color:#fff}
    .spacer{flex:1}
    input[type="text"], input[type="number"], select{
      background:#0f0f0f;color:#fff;border:1px solid var(--line);border-radius:8px;padding:.55rem .7rem;font-weight:700;
    }
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:0;background:var(--panel);z-index:1}
    th,td{border-bottom:1px solid var(--line);padding:.6rem .5rem;text-align:left}
    th{font-size:.8rem;letter-spacing:.08em;color:#dcdcdc;text-transform:uppercase}
    tr:hover td{background:#101010}
    td input[type="text"], td select{width:100%}
    .right{text-align:right}
    .center{text-align:center}
    .pill{display:inline-block;padding:.2rem .5rem;border:1px solid var(--line);border-radius:999px;color:#dcdcdc;font-weight:800}
    .del{background:transparent;border:1px solid var(--line);color:#fff;border-radius:8px;padding:.35rem .6rem;cursor:pointer}
    .del:hover{background:#1a1a1a}
    .footer-note{color:var(--muted);margin-top:10px;font-size:.9rem}
    .toast{position:fixed;right:14px;bottom:14px;background:#0f0f0f;border:1px solid #2a2a2a;padding:.6rem .9rem;border-radius:10px;font-weight:900;box-shadow:0 10px 24px rgba(0,0,0,.35);opacity:0;transform:translateY(8px);transition:.2s}
    .toast.show{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <!-- Simple PIN Gate (same as admin.html) -->
  <script>
    const PIN = '0429';
    const KEY = 'admin_ok';
    if (!sessionStorage.getItem(KEY)) {
      const input = prompt('Enter admin PIN');
      if (input === PIN) {
        sessionStorage.setItem(KEY, '1');
      } else {
        location.replace('/');
      }
    }
    document.documentElement.classList.remove('locked');
  </script>
  <div class="wrap">
    <header>
      <a class="back" href="./admin.html">← Back to Admin</a>
      <img src="images/obiri.png" alt="OBÍRÍ logo (mono)">
    </header>
    <h1>PRICE EDITOR</h1>
    <p class="sub">Pick Food/Drinks, choose the item from the dropdown, type price normally, toggle availability, or delete.</p>
    <div class="panel">
      <div class="toolbar">
        <input id="search" type="text" placeholder="Search item or category…"/>
        <select id="filterType" title="Filter">
          <option value="">Show: All</option>
          <option value="Drinks">Drinks only</option>
          <option value="Food">Food only</option>
        </select>
        <div class="spacer"></div>
        <button class="btn" id="addItem">Add Item</button>
        <button class="btn" id="saveBtn">Save</button>
        <button class="btn" id="download">Download JSON</button>
        <label class="btn btn-ghost" for="file">Load JSON</label>
        <input id="file" type="file" accept=".json" hidden/>
        <button class="btn btn-ghost" id="resetTwo">Start fresh (2 rows)</button>
        <button class="btn btn-ghost" id="clearAll">Clear All (cloud)</button>
        <button class="btn btn-ghost" id="reloadSheet">Reload Sheet</button>
      </div>
      <table id="tbl">
        <thead>
          <tr>
            <th style="width:130px">Type</th>
            <th>Item (choose from dropdown)</th>
            <th class="right" style="width:140px">Price (₦)</th>
            <th class="center" style="width:120px">Available</th>
            <th class="right" style="width:110px">Action</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
      <div class="footer-note">Data is saved in your <b>Google Sheet (cloud)</b> for OBÍRÍ. LocalStorage is NOT used.</div>
    </div>
  </div>
  <div id="toast" class="toast">Saved ✓</div>
<script>
  // === Cloud integration settings ===
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzglCNUwMTg89aylX0vfv5_w9N1x2Ay1JKtNCq2AiP64vJ8ZuJjzaL9oHipM_-yJmxsww/exec';
  const TOKEN = 'Forgive1988@';

  const parseNaira  = s => Number(String(s).replace(/[^0-9]/g,'') || 0);
  let data = [];
  let q = '';
  let filterType = '';

  // DRINKS CATALOG (original, unchanged)
  const drinksCatalog = {
    'Beers / Stouts': [
      {name:'Big Beers / Stouts', price:2500},
      {name:'Small Beers / Stouts', price:2000},
      {name:'Heineken', price:2500},
      {name:'Star Radler', price:2000},
      {name:'Desperados', price:2000},
      {name:'Flying Fish', price:2000},
      {name:'Legend Twist', price:2000},
      {name:'Smirnoff Ice (Small)', price:2000},
      {name:'Smirnoff Ice (Double Black)', price:2000}
    ],
    'Gin': [
      {name:'Bombay', price:45000},
      {name:'Gordons (Small)', price:5000},
      {name:'Gordons (Big)', price:25000}
    ],
    'Tequila': [
      {name:'Shot', price:2000},
      {name:'Bottle', price:45000}
    ],
    'Softs & Water': [
      {name:'Chi-Active', price:3000},
      {name:'Chivita Exotic', price:3000},
      {name:'Coke / Fanta / Sprite', price:1040},
      {name:'Fayrouz', price:1040},
      {name:'Hollandia', price:3000},
      {name:'Water', price:600},
      {name:'Schweppes', price:1040},
      {name:'Malts', price:1040}
    ],
    'Energy Drinks': [
      {name:'Black Bullet', price:2600},
      {name:'Blue Bullet', price:2600},
      {name:'Red Bull', price:2600},
      {name:'Power Horse', price:2600}
    ],
    'Sparkling Wine': [
      {name:'Andre Rose', price:35000},
      {name:'Andre Brut', price:40000},
      {name:'Martini Rose', price:35000}
    ],
    'Wine': [
      {name:'Four Cousins', price:18000},
      {name:'Drostdy Hoff (Big)', price:18000},
      {name:'Drostdy (Small)', price:10000},
      {name:'Expression', price:18000},
      {name:'Sweet Lips', price:20000},
      {name:'Carlo Rossi', price:20000}
    ],
    'Cream Liqueur': [
      {name:'Baileys', price:45000},
      {name:'Amarula', price:40000}
    ],
    'Brandy': [
      {name:'Hennessy VS', price:100000},
      {name:'Hennessy VSOP', price:150000},
      {name:'Hennessy XO', price:650000},
      {name:'Remy Martin VSOP', price:130000},
      {name:'Martel VS', price:100000},
      {name:'Martel VSOP', price:110000},
      {name:'Martel Blue Swift', price:140000}
    ],
    'Whiskey': [
      {name:'Jameson Black', price:70000},
      {name:'Jameson Green', price:55000},
      {name:'Glenfiddich 21 Years', price:600000},
      {name:'Glenfiddich 18 Years', price:250000},
      {name:'Glenfiddich 15 Years', price:140000},
      {name:'Glenfiddich 12 Years', price:100000},
      {name:'Glenmorangie 18 Years', price:300000},
      {name:'Glenmorangie 10 Years', price:80000},
      {name:'Black Label', price:70000},
      {name:'Gold Label', price:110000},
      {name:'Monkey Shoulder', price:70000},
      {name:'Macallan 12 Years', price:150000},
      {name:'Singleton 12 Years', price:100000},
      {name:'Observatory 20 Years', price:70000},
      {name:'Jack Daniels', price:65000},
      {name:'American Honey', price:45000}
    ],
    'Champagne': [
      {name:'Don P', price:850000},
      {name:'Veuve Rich', price:250000},
      {name:'Moët Rich', price:190000},
      {name:'Veuve Clicquot Brut', price:170000},
      {name:'Belaire', price:100000}
    ],
    'Milkshakes': [
      {name:'Milkshakes', price:8900}
    ],
    'Smoothies': [
      {name:'Smoothies', price:8900}
    ],
    'Cocktails – Regular': [
      {name:'Cocktails', price:8900}
    ],
    'Cocktails – Non-Alcoholic': [
      {name:'Non-Alcoholic Cocktails', price:7900}
    ],
    'Cocktails – Shots': [
      {name:'Cocktail Shots', price:2500},
      {name:'Tequila Shots', price:2000}
    ],
    'Cocktails – Signatures': [
      {name:'Special Cocktail Signatures', price:9900}
    ],
    'Liquor / Bitters': [
      {name:'Palm Wine', price:4500},
      {name:'Origin Bitters (Small)', price:5000},
      {name:'Origin Bitters (Big)', price:10000},
      {name:'Odogwu Bitters (Small)', price:3500},
      {name:'D-General', price:3500},
      {name:'Campari', price:40000}
    ]
  };

  // FOOD CATALOG (now filled)
  const foodCatalog = {
    'Soups': [
      {name:'Afang', price:6000},
      {name:'Egusi', price:6000},
      {name:'Ogbono', price:6000},
      {name:'Ofe Onugbu (Bitterleaf)', price:6000},
      {name:'Oha', price:6000},
      {name:'Okra', price:6000},
      {name:'Banga', price:7000},
      {name:'Ofensala', price:8000},
      {name:'Native Soup', price:10000}
    ],
    'Signature Pots': [
      {name:'Ikwerre Okazi', price:25000},
      {name:'Fisherman Soup (Red Snapper Head)', price:30000},
      {name:'Seafood Okra (Red Snapper — Head)', price:30000},
      {name:'Seafood Okra (Red Snapper — Middle/Tail)', price:25000}
    ],
    'Proteins': [
      {name:'Goat Meat', price:7000},
      {name:'Dried Goat Meat', price:7000},
      {name:'Cow Leg, Head & Tail', price:6500},
      {name:'Bushmeat', price:7500},
      {name:'Dried Catfish', price:6000},
      {name:'Chicken', price:7000},
      {name:'Beef', price:6500},
      {name:'Dried Beef', price:6500},
      {name:'Croaker', price:7000},
      {name:'Fresh Catfish', price:6000},
      {name:'Cow Assorted', price:6500},
      {name:'Goat Assorted', price:6500},
      {name:'Snail', price:10000}
    ],
    'Pepper Soup': [
      {name:'Goat Meat', price:8000},
      {name:'Cow Leg, Head & Tail', price:10000},
      {name:'Bushmeat', price:11000},
      {name:'Fresh Catfish', price:8000},
      {name:'Cow Assorted', price:10000},
      {name:'Goat Assorted', price:10000},
      {name:'Chicken', price:8000},
      {name:'Fresh Red Snapper', price:12000},
      {name:'Beef', price:8000}
    ],
    'Pepper Dem (Anu-Gworogwu)': [
      {name:'Bayelsa Suya', price:7000},
      {name:'Peppered Snail', price:12000},
      {name:'Bushmeat', price:10000},
      {name:'Peppered Goat Meat', price:8000},
      {name:'Peppered Cow Meat', price:8000},
      {name:'Peppered Beef', price:8500},
      {name:'Peppered Chicken', price:8000},
      {name:'Matching Ground', price:10000},
      {name:'Nkwobi', price:9500},
      {name:'Isiewu', price:12000},
      {name:'Ugba', price:5000},
      {name:'Kpomo', price:2500},
      {name:'Stockfish', price:4500},
      {name:'Fried Fish', price:3000},
      {name:'Abacha', price:6000}
    ],
    'Rice': [
      {name:'Native Rice', price:7000},
      {name:'Jollof Rice', price:6000},
      {name:'Coconut Rice', price:6500},
      {name:'White Rice', price:2500}
    ],
    'Sides': [
      {name:'Fried Plantain (as side)', price:500},
      {name:'Fried Yam', price:3000},
      {name:'Fried Plantain', price:3000},
      {name:'Agidi', price:1000},
      {name:'Plantain Porridge', price:5000},
      {name:'Porridge Yam', price:5000}
    ],
    'Swallow': [
      {name:'Eba', price:1500},
      {name:'Semo', price:1500},
      {name:'Poundo', price:1500},
      {name:'Oatmeal', price:2500},
      {name:'Wheat', price:2000},
      {name:'Plantain Flour', price:2500}
    ],
    'Barbeque': [
      {name:'Grilled Catfish', price:20000},
      {name:'Croaker (marinated) — Big', price:20000},
      {name:'Croaker (marinated) — Small', price:15000}
    ]
  };

  const rowsEl = document.getElementById('rows');
  const toast = (m='Saved ✓') => { const t=document.getElementById('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200); };

  function catalogForType(type){
    return type === 'Food' ? foodCatalog : drinksCatalog;
  }

  function makeTypeSelect(row){
    const sel = document.createElement('select');
    ['Drinks','Food'].forEach(t=>{
      const o=document.createElement('option'); o.value=o.textContent=t;
      if(row.type===t) o.selected=true;
      sel.appendChild(o);
    });
    sel.onchange = e => {
      row.type = e.target.value;
      row.cat = ''; row.name=''; row.price=0;
      saveToSheet();
      render();
    };
    return sel;
  }

  function makeItemSelect(row){
    const sel = document.createElement('select');
    sel.appendChild(new Option('— pick item —', ''));
    const catalog = catalogForType(row.type);
    const cats = Object.keys(catalog);

    if (!cats.length){
      sel.appendChild(new Option('(No items yet)', ''));
      sel.disabled = true;
    } else {
      cats.forEach(cat=>{
        const og = document.createElement('optgroup');
        og.label = cat;
        (catalog[cat]||[]).forEach(it=>{
          const val = `${cat}|||${it.name}`;
          const opt = new Option(it.name, val);
          if (row.cat===cat && row.name===it.name) opt.selected = true;
          og.appendChild(opt);
        });
        sel.appendChild(og);
      });
    }
    sel.appendChild(new Option('— Custom item… —','__custom__'));
    sel.onchange = () => {
      if (sel.value === '__custom__'){
        const customName = prompt('Enter custom item name');
        if (customName){
          row.name = customName; row.cat='(Custom)';
          saveToSheet();
          render();
        } else { render(); }
        return;
      }
      if (!sel.value){ row.name=''; row.cat=''; saveToSheet(); render(); return; }
      const [cat,name] = sel.value.split('|||');
      row.cat = cat; row.name = name;
      const found = (catalog[cat]||[]).find(i=>i.name===name);
      if (found) row.price = Number(found.price)||0;
      saveToSheet();
      render();
    };
    return sel;
  }

  function render(){
    const needle = q.trim().toLowerCase();
    const filtered = data.filter(r=>{
      const textMatch = !needle || (r.name||'').toLowerCase().includes(needle) || (r.cat||'').toLowerCase().includes(needle);
      const typeMatch = !filterType || r.type===filterType;
      return textMatch && typeMatch;
    });

    rowsEl.innerHTML = '';
    for (const r of filtered){
      const tr = document.createElement('tr');
      const tdType  = document.createElement('td'); tdType.appendChild(makeTypeSelect(r));
      const tdItem  = document.createElement('td'); tdItem.appendChild(makeItemSelect(r));

      const tdPrice = document.createElement('td'); tdPrice.className='right';
      const inPrice = document.createElement('input');
      inPrice.type='text'; inPrice.inputMode='numeric';
      inPrice.value = r.price ? String(r.price) : '';
      inPrice.placeholder = '0';
      inPrice.oninput = e => { r.price = parseNaira(e.target.value); saveToSheet(); };
      tdPrice.appendChild(inPrice);

      const tdAvail = document.createElement('td'); tdAvail.className='center';
      const chk = document.createElement('input'); chk.type='checkbox'; chk.checked = !!r.available;
      chk.onchange = e => { r.available = e.target.checked; saveToSheet(); };
      tdAvail.appendChild(chk);

      const tdAct = document.createElement('td'); tdAct.className='right';
      const del = document.createElement('button'); del.className='del'; del.textContent='Delete';
      del.onclick = () => { data = data.filter(x => x.id !== r.id); saveToSheet(); render(); };
      tdAct.appendChild(del);

      tr.append(tdType, tdItem, tdPrice, tdAvail, tdAct);
      rowsEl.appendChild(tr);
    }
  }

  function loadFromSheet() {
    fetch(`${ENDPOINT}?token=${TOKEN}`)
      .then(res => res.json())
      .then(result => {
        if (result.ok && Array.isArray(result.rows)) {
          data = result.rows.length
            ? result.rows
            : [
                {id:crypto.randomUUID(), type:'Drinks', cat:'', name:'', price:0, available:true},
                {id:crypto.randomUUID(), type:'Food',   cat:'', name:'', price:0, available:true}
              ];
          render();
          toast('Loaded from sheet ✓');
        } else {
          toast('Error loading sheet!');
        }
      })
      .catch(() => toast('Error (network) loading.'));
  }

  function saveToSheet() {
    const form = new URLSearchParams();
    form.append('token', TOKEN);
    form.append('op', 'write');
    form.append('rows', JSON.stringify(data));
    fetch(ENDPOINT, {
      method: 'POST',
      body: form
    }).then(res => res.json())
      .then(result => {
        if (result.ok) toast('Saved to sheet ✓');
        else toast('Save error: '+result.error);
      })
      .catch(() => toast('Error (network) saving.'));
  }

  document.getElementById('addItem').onclick = () => {
    const startType = filterType || 'Drinks';
    data.unshift({id:crypto.randomUUID(), type:startType, cat:'', name:'', price:0, available:true});
    saveToSheet();
    render();
  };
  document.getElementById('saveBtn').onclick = () => { saveToSheet(); };

  document.getElementById('download').onclick = () => {
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `obiri-prices-${new Date().toISOString().slice(0,10)}.json`;
    a.click(); URL.revokeObjectURL(a.href);
  };

  document.getElementById('file').onchange = e => {
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const imported = JSON.parse(reader.result);
        if(!Array.isArray(imported)) throw new Error('Invalid format');
        data = imported.map(x => ({
          id: x.id || crypto.randomUUID(),
          type: x.type === 'Food' ? 'Food' : 'Drinks',
          cat: x.cat || '',
          name: x.name || '',
          price: Number(x.price)||0,
          available: !!x.available
        }));
        saveToSheet();
        render();
        toast('Loaded ✓');
      }catch(err){ alert('Could not load JSON: '+err.message); }
    };
    reader.readAsText(file); e.target.value='';
  };

  document.getElementById('clearAll').onclick = () => {
    if(confirm('Clear ALL menu items in Sheet (cloud)?')) {
      data=[];
      saveToSheet();
      render();
      toast('Cleared ✓');
    }
  };

  document.getElementById('resetTwo').onclick = () => {
    if(confirm('Replace items with 2 rows (Drinks + Food)?')){
      data = [
        {id:crypto.randomUUID(), type:'Drinks', cat:'', name:'', price:0, available:true},
        {id:crypto.randomUUID(), type:'Food',   cat:'', name:'', price:0, available:true},
      ];
      saveToSheet();
      render();
      toast('Ready ✓');
    }
  };
  document.getElementById('reloadSheet').onclick = () => { loadFromSheet(); };

  document.getElementById('search').oninput = e => { q = e.target.value; render(); };
  document.getElementById('filterType').onchange = e => { filterType = e.target.value; render(); };

  // Always start: load from Google Sheet
  loadFromSheet();
</script>
</body>
</html>
